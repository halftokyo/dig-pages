<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ä¸œäº¬ç±³å…¶æ—æ¨èé¤å…ï¼ˆÂ¥20,000 ä»¥ä¸‹ï¼‰</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg" />
    <link rel="stylesheet" href="css/medium-style.css" />
    <link rel="stylesheet" href="css/restaurant-page.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-container">
            <a href="index.html" class="logo">dig</a>
        </div>
    </nav>

    <div class="container">
        <header class="hero-section">
            <div class="hero-content">
                <div class="hero-text">
                    <h1 class="hero-title">ä¸œäº¬ç±³å…¶æ—æ¨èé¤å…ç²¾é€‰</h1>
                    <p class="hero-subtitle">Â¥20,000ä»¥ä¸‹çš„ç±³å…¶æ—æ¨èé¤å…ï¼Œè®©æ‚¨ä»¥åˆç†ä»·æ ¼äº«å—é¡¶çº§ç¾é£Ÿä½“éªŒ</p>
                </div>
                <div class="hero-image">
                    <div class="hero-image-container">
                        <div class="hero-image-overlay"></div>
                        <div class="hero-image-content">
                            <div class="michelin-star">â­</div>
                            <div class="food-icons">
                                <span class="food-icon">ğŸœ</span>
                                <span class="food-icon">ğŸ±</span>
                                <span class="food-icon">ğŸ£</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- ç­›é€‰å™¨ -->
        <section class="filter-section">
            <!-- ç§»åŠ¨ç«¯ç­›é€‰ -->
            <div class="mobile-filter">
                <div class="filter-group">
                    <div class="grid grid-cols-2 gap-3">
                        <!-- ä»·æ ¼ç­›é€‰ä¸‹æ‹‰ -->
                        <div>
                            <select id="mobilePriceFilter" class="mobile-filter-select">
                                <option value="">ä»·æ ¼åŒºé—´</option>
                                <option value="Â¥5,000 ä»¥ä¸‹">Â¥5,000 ä»¥ä¸‹</option>
                                <option value="Â¥5,000â€“Â¥10,000">Â¥5,000â€“Â¥10,000</option>
                                <option value="Â¥10,000â€“Â¥20,000">Â¥10,000â€“Â¥20,000</option>
                            </select>
                        </div>
                        <!-- åœ°åŒºç­›é€‰ä¸‹æ‹‰ -->
                        <div>
                            <select id="mobileAreaFilter" class="mobile-filter-select">
                                <option value="">æ‰€åœ¨åœ°åŒº</option>
                                <option value="åƒä»£ç”°åŒº">åƒä»£ç”°åŒº</option>
                                <option value="ä¸­å¤®åŒº">ä¸­å¤®åŒº</option>
                                <option value="æ¸¯åŒº">æ¸¯åŒº</option>
                                <option value="æ–°å®¿åŒº">æ–°å®¿åŒº</option>
                                <option value="æ¸‹è°·åŒº">æ¸‹è°·åŒº</option>
                                <option value="æ‰ä¸¦åŒº">æ‰ä¸¦åŒº</option>
                            </select>
                        </div>
                    </div>
                </div>
                <!-- èœç³»ç­›é€‰æ ‡ç­¾ -->
                <div class="filter-group">
                    <div class="filter-buttons">
                        <button onclick="filterByCuisine('')" class="filter-btn active">å…¨éƒ¨</button>
                        <button onclick="filterByCuisine('æ‹‰é¢')" class="filter-btn">æ‹‰é¢</button>
                        <button onclick="filterByCuisine('çŒªæ’')" class="filter-btn">çŒªæ’</button>
                        <button onclick="filterByCuisine('èéº¦')" class="filter-btn">èéº¦</button>
                        <button onclick="filterByCuisine('å¤©å¦‡ç½—')" class="filter-btn">å¤©å¦‡ç½—</button>
                        <button onclick="filterByCuisine('æ³•å›½æ–™ç†')" class="filter-btn">æ³•å›½æ–™ç†</button>
                        <button onclick="filterByCuisine('å°åº¦æ–™ç†')" class="filter-btn">å°åº¦æ–™ç†</button>
                        <button onclick="filterByCuisine('æ—¥æœ¬æ–™ç†')" class="filter-btn">æ—¥æœ¬æ–™ç†</button>
                        <button onclick="filterByCuisine('å¯¿å¸')" class="filter-btn">å¯¿å¸</button>
                        <button onclick="filterByCuisine('çƒ§é¸Ÿ')" class="filter-btn">çƒ§é¸Ÿ</button>
                        <button onclick="filterByCuisine('æ„å¤§åˆ©æ–™ç†')" class="filter-btn">æ„å¤§åˆ©æ–™ç†</button>
                        <button onclick="filterByCuisine('é³—é±¼')" class="filter-btn">é³—é±¼</button>
                        <button onclick="filterByCuisine('é¥­å›¢')" class="filter-btn">é¥­å›¢</button>
                        <button onclick="filterByCuisine('è¥¿é¤')" class="filter-btn">è¥¿é¤</button>
                    </div>
                    <div style="margin-top: var(--spacing-lg); display: flex; justify-content: space-between; align-items: center;">
                        <button onclick="resetFilters()" class="reset-btn">é‡ç½®ç­›é€‰</button>
                        <span id="resultCount" class="result-count"></span>
                    </div>
                </div>
            </div>

            <!-- æ¡Œé¢ç«¯ç­›é€‰ -->
            <div class="desktop-filter">
                <div class="filter-group">
                    <div class="filter-group-title">ä»·æ ¼åŒºé—´</div>
                    <div class="filter-buttons">
                        <button onclick="filterByPrice('')" class="filter-btn active">å…¨éƒ¨ä»·ä½</button>
                        <button onclick="filterByPrice('Â¥5,000 ä»¥ä¸‹')" class="filter-btn">Â¥5,000 ä»¥ä¸‹</button>
                        <button onclick="filterByPrice('Â¥5,000â€“Â¥10,000')" class="filter-btn">Â¥5,000â€“Â¥10,000</button>
                        <button onclick="filterByPrice('Â¥10,000â€“Â¥20,000')" class="filter-btn">Â¥10,000â€“Â¥20,000</button>
                    </div>
                </div>

                <div class="filter-group">
                    <div class="filter-group-title">èœç³»ç±»å‹</div>
                    <div class="filter-buttons">
                        <button onclick="filterByCuisine('')" class="filter-btn active">å…¨éƒ¨èœç³»</button>
                        <button onclick="filterByCuisine('æ‹‰é¢')" class="filter-btn">æ‹‰é¢</button>
                        <button onclick="filterByCuisine('çŒªæ’')" class="filter-btn">çŒªæ’</button>
                        <button onclick="filterByCuisine('èéº¦')" class="filter-btn">èéº¦</button>
                        <button onclick="filterByCuisine('å¤©å¦‡ç½—')" class="filter-btn">å¤©å¦‡ç½—</button>
                        <button onclick="filterByCuisine('æ³•å›½æ–™ç†')" class="filter-btn">æ³•å›½æ–™ç†</button>
                        <button onclick="filterByCuisine('å°åº¦æ–™ç†')" class="filter-btn">å°åº¦æ–™ç†</button>
                        <button onclick="filterByCuisine('æ—¥æœ¬æ–™ç†')" class="filter-btn">æ—¥æœ¬æ–™ç†</button>
                        <button onclick="filterByCuisine('å¯¿å¸')" class="filter-btn">å¯¿å¸</button>
                        <button onclick="filterByCuisine('çƒ§é¸Ÿ')" class="filter-btn">çƒ§é¸Ÿ</button>
                        <button onclick="filterByCuisine('æ„å¤§åˆ©æ–™ç†')" class="filter-btn">æ„å¤§åˆ©æ–™ç†</button>
                        <button onclick="filterByCuisine('é³—é±¼')" class="filter-btn">é³—é±¼</button>
                        <button onclick="filterByCuisine('é¥­å›¢')" class="filter-btn">é¥­å›¢</button>
                        <button onclick="filterByCuisine('è¥¿é¤')" class="filter-btn">è¥¿é¤</button>
                    </div>
                </div>

                <div class="filter-group">
                    <div class="filter-group-title">æ‰€åœ¨åœ°åŒº</div>
                    <div class="filter-buttons">
                        <button onclick="filterByArea('')" class="filter-btn active">å…¨éƒ¨åœ°åŒº</button>
                        <button onclick="filterByArea('åƒä»£ç”°åŒº')" class="filter-btn">åƒä»£ç”°åŒº</button>
                        <button onclick="filterByArea('ä¸­å¤®åŒº')" class="filter-btn">ä¸­å¤®åŒº</button>
                        <button onclick="filterByArea('æ¸¯åŒº')" class="filter-btn">æ¸¯åŒº</button>
                        <button onclick="filterByArea('æ–°å®¿åŒº')" class="filter-btn">æ–°å®¿åŒº</button>
                        <button onclick="filterByArea('æ¶©è°·åŒº')" class="filter-btn">æ¶©è°·åŒº</button>
                        <button onclick="filterByArea('æ‰å¹¶åŒº')" class="filter-btn">æ‰å¹¶åŒº</button>
                    </div>
                </div>

                <div class="flex justify-between items-center">
                    <button onclick="resetFilters()" class="reset-btn">é‡ç½®ç­›é€‰</button>
                    <span id="resultCountDesktop" class="result-count"></span>
                </div>
            </div>
        </section>

        <section>
            <h2 class="title-section">ç²¾é€‰é¤å…æ¨è</h2>
            <div id="restaurantList" class="restaurant-grid">
            </div>
        </section>
    </div>

    <script>
        let restaurants = [];
        let allRestaurants = [];

        // ä»JSONæ–‡ä»¶åŠ è½½é¤å…æ•°æ®
        async function loadRestaurants() {
            try {
                const response = await fetch('tokyo-under-20k-restaurants.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                
                console.log('åŠ è½½çš„æ•°æ®:', data.length, 'å®¶é¤å…');
                
                // è½¬æ¢JSONæ•°æ®æ ¼å¼ä¸ºé¡µé¢æ‰€éœ€æ ¼å¼
                allRestaurants = data.map(restaurant => ({
                    name: restaurant.name_en,
                    jpName: restaurant.name_jp,
                    type: restaurant.michelin_type || "æ¨è",
                    cuisine: mapCuisineType(restaurant.cuisine),
                    area: restaurant.ward,
                    rating: restaurant.tabelog_rating,
                    price: restaurant.price_estimate,
                    priceTier: mapPriceTier(restaurant.price_estimate),
                    reservable: restaurant.online_booking ? "æ˜¯" : "å¦",
                    reason: restaurant.tabelog_review_summary,
                    website: restaurant.website
                }));
                
                restaurants = allRestaurants;
                console.log('è½¬æ¢åçš„æ•°æ®:', restaurants.length, 'å®¶é¤å…');
                renderList(restaurants);
                updateFilterButtons();
            } catch (error) {
                console.error('åŠ è½½é¤å…æ•°æ®å¤±è´¥:', error);
                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                const restaurantList = document.getElementById('restaurantList');
                if (restaurantList) {
                    restaurantList.innerHTML = 
                        '<div class="col-span-full text-center text-red-600 p-8">æ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•<br><small>é”™è¯¯ä¿¡æ¯: ' + error.message + '</small></div>';
                }
            }
        }

        // æ˜ å°„èœç³»ç±»å‹ï¼ˆç°åœ¨éƒ½æ˜¯ä¸­æ–‡ï¼Œç›´æ¥è¿”å›ï¼‰
        function mapCuisineType(cuisine) {
            return cuisine;
        }

        // æ˜ å°„ä»·æ ¼åŒºé—´
        function mapPriceTier(priceEstimate) {
            if (!priceEstimate) return "æœªçŸ¥";
            
            // æå–ä»·æ ¼æ•°å­—ï¼Œå¤„ç†å„ç§æ ¼å¼
            const priceMatch = priceEstimate.match(/Â¥(\d+(?:,\d+)?)/g);
            if (!priceMatch) return "æœªçŸ¥";
            
            const prices = priceMatch.map(p => parseInt(p.replace(/Â¥|,/g, '')));
            const maxPrice = Math.max(...prices);
            
            if (maxPrice <= 5000) return "Â¥5,000 ä»¥ä¸‹";
            if (maxPrice <= 10000) return "Â¥5,000â€“Â¥10,000";
            return "Â¥10,000â€“Â¥20,000";
        }

        // æ›´æ–°ç­›é€‰æŒ‰é’®
        function updateFilterButtons() {
            // è·å–æ‰€æœ‰ç‹¬ç‰¹çš„èœç³»ç±»å‹
            const cuisines = [...new Set(allRestaurants.map(r => r.cuisine))];
            const areas = [...new Set(allRestaurants.map(r => r.area))];
            
            // æ›´æ–°ç§»åŠ¨ç«¯èœç³»æŒ‰é’®
            updateCuisineButtons(cuisines);
            // æ›´æ–°åœ°åŒºé€‰æ‹©å™¨
            updateAreaSelectors(areas);
        }

        function updateCuisineButtons(cuisines) {
            console.log('æ›´æ–°èœç³»æŒ‰é’®:', cuisines);
            
            // ç§»åŠ¨ç«¯èœç³»æŒ‰é’®æ›´æ–°
            const mobileContainer = document.querySelector('.mobile-filter .filter-buttons');
            if (mobileContainer) {
                // ä¿ç•™"å…¨éƒ¨"æŒ‰é’®ï¼Œæ¸…é™¤å…¶ä»–æŒ‰é’®
                const buttons = mobileContainer.querySelectorAll('button:not([onclick="filterByCuisine(\'\')"])');
                buttons.forEach(btn => btn.remove());
                
                // æ·»åŠ æ–°çš„èœç³»æŒ‰é’®
                cuisines.sort().forEach(cuisine => {
                    const button = document.createElement('button');
                    button.onclick = () => filterByCuisine(cuisine);
                    button.className = 'filter-btn';
                    button.textContent = cuisine;
                    mobileContainer.appendChild(button);
                });
            }

            // æ¡Œé¢ç«¯èœç³»æŒ‰é’®æ›´æ–°
            const desktopContainer = document.querySelector('.desktop-filter .filter-group:nth-child(2) .filter-buttons');
            if (desktopContainer) {
                // ä¿ç•™"å…¨éƒ¨"æŒ‰é’®ï¼Œæ¸…é™¤å…¶ä»–æŒ‰é’®
                const buttons = desktopContainer.querySelectorAll('button:not([onclick="filterByCuisine(\'\')"])');
                buttons.forEach(btn => btn.remove());
                
                // æ·»åŠ æ–°çš„èœç³»æŒ‰é’®
                cuisines.sort().forEach(cuisine => {
                    const button = document.createElement('button');
                    button.onclick = () => filterByCuisine(cuisine);
                    button.className = 'filter-btn';
                    button.textContent = cuisine;
                    desktopContainer.appendChild(button);
                });
            }
        }

        function updateAreaSelectors(areas) {
            console.log('æ›´æ–°åœ°åŒºé€‰æ‹©å™¨:', areas);
            
            // æ›´æ–°ç§»åŠ¨ç«¯åœ°åŒºé€‰æ‹©å™¨
            const mobileAreaSelect = document.getElementById('mobileAreaFilter');
            if (mobileAreaSelect) {
                // æ¸…é™¤ç°æœ‰é€‰é¡¹ï¼ˆä¿ç•™ç¬¬ä¸€ä¸ª"æ‰€åœ¨åœ°åŒº"é€‰é¡¹ï¼‰
                while (mobileAreaSelect.children.length > 1) {
                    mobileAreaSelect.removeChild(mobileAreaSelect.lastChild);
                }
                
                // æ·»åŠ æ–°çš„åœ°åŒºé€‰é¡¹
                areas.sort().forEach(area => {
                    const option = document.createElement('option');
                    option.value = area;
                    option.textContent = area;
                    mobileAreaSelect.appendChild(option);
                });
            }

            // æ›´æ–°æ¡Œé¢ç«¯åœ°åŒºæŒ‰é’®
            const desktopContainer = document.querySelector('.desktop-filter .filter-group:nth-child(3) .filter-buttons');
            if (desktopContainer) {
                // ä¿ç•™"å…¨éƒ¨"æŒ‰é’®ï¼Œæ¸…é™¤å…¶ä»–æŒ‰é’®
                const buttons = desktopContainer.querySelectorAll('button:not([onclick="filterByArea(\'\')"])');
                buttons.forEach(btn => btn.remove());
                
                // æ·»åŠ æ–°çš„åœ°åŒºæŒ‰é’®
                areas.sort().forEach(area => {
                    const button = document.createElement('button');
                    button.onclick = () => filterByArea(area);
                    button.className = 'filter-btn';
                    button.textContent = area;
                    desktopContainer.appendChild(button);
                });
            }
        }

        const list = document.getElementById("restaurantList");

        function renderList(data) {
            if (!list) return;
            
            list.innerHTML = data.map(r => {
                // å¤„ç†ç±³å…¶æ—ç­‰çº§æ˜¾ç¤º
                let typeDisplay = '';
                let typeClass = '';
                
                if (r.type === 'ä¸€æ˜Ÿ') {
                    typeDisplay = 'ä¸€æ˜Ÿ';
                    typeClass = 'michelin-badge michelin-one-star';
                } else if (r.type === 'äºŒæ˜Ÿ') {
                    typeDisplay = 'äºŒæ˜Ÿ';
                    typeClass = 'michelin-badge michelin-two-star';
                } else if (r.type === 'å¿…æ¯”ç™»') {
                    typeDisplay = 'å¿…æ¯”ç™»';
                    typeClass = 'michelin-badge michelin-bib';
                } else {
                    typeDisplay = 'æ¨è';
                    typeClass = 'michelin-badge michelin-recommended';
                }
                
                return `
        <div class="restaurant-card">
          <span class="${typeClass}">${typeDisplay}</span>
          <h3 class="restaurant-title">${r.jpName || r.name}</h3>
          <p class="restaurant-subtitle">${r.name || r.jpName}</p>
          <div class="restaurant-info-grid">
            <div class="restaurant-info-item"><span class="restaurant-info-label">èœç³»ï¼š</span>${r.cuisine}</div>
            <div class="restaurant-info-item"><span class="restaurant-info-label">åœ°åŒºï¼š</span>${r.area}</div>
            <div class="restaurant-info-item"><span class="restaurant-info-label">è¯„åˆ†ï¼š</span>${r.rating ? r.rating + '/5' : 'æš‚æ— è¯„åˆ†'}</div>
            <div class="restaurant-info-item"><span class="restaurant-info-label">ä»·æ ¼ï¼š</span>${r.price}</div>
          </div>
          <div class="reservation-status ${r.reservable === 'æ˜¯' ? 'reservation-available' : 'reservation-unavailable'}">
            ${r.reservable === 'æ˜¯' ? 'å¯é¢„çº¦' : 'ä¸å¯é¢„çº¦'}
          </div>
          <p class="restaurant-description">${r.reason}</p>
          ${r.website ? `<a href="${r.website}" target="_blank" class="restaurant-link">æŸ¥çœ‹å®˜ç½‘</a>` : ''}
        </div>`;
            }).join("");

            // æ›´æ–°ç»“æœè®¡æ•°
            updateResultCount(data.length);
        }

        let currentFilters = {
            price: '',
            cuisine: '',
            area: ''
        };

        function filterByPrice(priceTier) {
            currentFilters.price = priceTier;
            updateButtons('.filter-btn', `[onclick="filterByPrice('${priceTier}')"]`);
            // åŒæ­¥ç§»åŠ¨ç«¯ä¸‹æ‹‰é€‰æ‹©
            document.getElementById('mobilePriceFilter').value = priceTier;
            applyFilters();
        }

        function filterByCuisine(cuisine) {
            currentFilters.cuisine = cuisine;
            updateButtons('.filter-btn', `[onclick="filterByCuisine('${cuisine}')"]`);
            applyFilters();
        }

        function filterByArea(area) {
            currentFilters.area = area;
            updateButtons('.filter-btn', `[onclick="filterByArea('${area}')"]`);
            // åŒæ­¥ç§»åŠ¨ç«¯ä¸‹æ‹‰é€‰æ‹©
            document.getElementById('mobileAreaFilter').value = area;
            applyFilters();
        }

        function updateButtons(selector, activeSelector) {
            document.querySelectorAll(selector).forEach(btn => {
                btn.classList.remove('active');
            });

            const activeBtn = document.querySelector(activeSelector);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }
        }

        function updateResultCount(count) {
            const countText = `å…± ${count} å®¶é¤å…`;
            const resultCountEl = document.getElementById('resultCount');
            const resultCountDesktopEl = document.getElementById('resultCountDesktop');
            if (resultCountEl) resultCountEl.textContent = countText;
            if (resultCountDesktopEl) resultCountDesktopEl.textContent = countText;
        }

        function applyFilters() {
            let result = [...restaurants];

            if (currentFilters.price) {
                result = result.filter(r => r.priceTier === currentFilters.price);
            }

            if (currentFilters.cuisine) {
                result = result.filter(r => r.cuisine === currentFilters.cuisine);
            }

            if (currentFilters.area) {
                result = result.filter(r => r.area === currentFilters.area);
            }

            renderList(result);
        }

        function resetFilters() {
            currentFilters = {
                price: '',
                cuisine: '',
                area: ''
            };

            // é‡ç½®ç§»åŠ¨ç«¯ä¸‹æ‹‰é€‰æ‹©
            document.getElementById('mobilePriceFilter').value = '';
            document.getElementById('mobileAreaFilter').value = '';

            updateButtons('.filter-btn', `[onclick="filterByPrice('')"]`);
            updateButtons('.filter-btn', `[onclick="filterByCuisine('')"]`);
            updateButtons('.filter-btn', `[onclick="filterByArea('')"]`);

            renderList(restaurants);
        }

        // ç§»åŠ¨ç«¯ä¸‹æ‹‰é€‰æ‹©äº‹ä»¶ç›‘å¬
        document.getElementById('mobilePriceFilter').addEventListener('change', function () {
            filterByPrice(this.value);
        });

        document.getElementById('mobileAreaFilter').addEventListener('change', function () {
            filterByArea(this.value);
        });

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–æ•°æ®
        document.addEventListener('DOMContentLoaded', function() {
            loadRestaurants();
        });
    </script>
</body>

</html>