<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>東京23区 外国人人口インフォグラフィック</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: #EAF6FF;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 50vh;
            max-height: 450px;
        }
        @media (min-width: 768px) {
            .chart-container {
                max-height: 500px;
                height: 40vh;
            }
        }
        .kpi-card {
            background-color: #004AAD;
            color: white;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="text-gray-800">
    <!-- Palette: Brilliant Blues (#004AAD, #0079FF, #52AFFF, #B3DAFF, #EAF6FF) -->
    <!-- NEITHER Mermaid JS NOR SVG were used in this output. -->

    <main class="container mx-auto p-4 md:p-8">

        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-[#004AAD] mb-4">東京の多文化共生</h1>
            <p class="text-lg md:text-xl text-gray-600 max-w-3xl mx-auto">23区の外国人人口データを可視化し、グローバル都市東京の今を読み解きます。</p>
        </header>

        <section id="kpi" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
            <div class="kpi-card rounded-xl shadow-lg p-6 flex flex-col justify-center items-center text-center">
                <h2 class="text-lg font-bold text-[#B3DAFF] mb-2">23区の外国人人口</h2>
                <p class="text-4xl md:text-5xl font-extrabold">721,223<span class="text-2xl font-semibold ml-2">人</span></p>
                <p class="text-sm text-[#B3DAFF] mt-2">(2025年1月1日時点)</p>
            </div>
            <div class="kpi-card rounded-xl shadow-lg p-6 flex flex-col justify-center items-center text-center">
                <h2 class="text-lg font-bold text-[#B3DAFF] mb-2">区部総人口に占める割合</h2>
                <p class="text-4xl md:text-5xl font-extrabold">7.41<span class="text-2xl font-semibold ml-2">%</span></p>
            </div>
            <div class="kpi-card rounded-xl shadow-lg p-6 flex flex-col justify-center items-center text-center">
                <h2 class="text-lg font-bold text-[#B3DAFF] mb-2">23区の総人口</h2>
                <p class="text-4xl md:text-5xl font-extrabold">973<span class="text-2xl font-semibold ml-1">万人</span></p>
                 <p class="text-sm text-[#B3DAFF] mt-2">(2024年12月1日時点)</p>
            </div>
        </section>

        <section id="nationality-breakdown" class="bg-white rounded-xl shadow-lg p-6 md:p-8 mb-12">
            <h2 class="text-2xl font-bold text-[#004AAD] mb-2 text-center">国籍別に見る構成</h2>
            <p class="text-center text-gray-600 mb-6 max-w-2xl mx-auto">外国人住民の出身地は多様ですが、特にアジア諸国が多数を占めています。以下のグラフは2024年1月時点のデータに基づきます。</p>
            <div class="chart-container" style="max-height: 400px; height: 50vh;">
                <canvas id="nationalityDonutChart"></canvas>
            </div>
        </section>

        <section id="ward-ranking" class="bg-white rounded-xl shadow-lg p-6 md:p-8 mb-12">
            <h2 class="text-2xl font-bold text-[#004AAD] mb-2 text-center">外国人比率 区別ランキング</h2>
            <p class="text-center text-gray-600 mb-6 max-w-2xl mx-auto">外国人住民の比率は区によって大きく異なります。どの区が国際的な特色を強く持っているかを見てみましょう。</p>
            <div class="chart-container" style="height: 70vh; max-height: 800px;">
                <canvas id="wardPercentageBarChart"></canvas>
            </div>
        </section>

        <section id="population-vs-percentage" class="bg-white rounded-xl shadow-lg p-6 md:p-8 mb-12">
            <h2 class="text-2xl font-bold text-[#004AAD] mb-2 text-center">人口規模と外国人比率の関係</h2>
            <p class="text-center text-gray-600 mb-6 max-w-2xl mx-auto">外国人比率の高さが、必ずしも人口の多さを意味するわけではありません。バブルチャートで、総人口、外国人比率、外国人人口の3つの関係性を探ります。</p>
            <div class="chart-container" style="max-height: 550px; height: 60vh;">
                <canvas id="populationBubbleChart"></canvas>
            </div>
        </section>

        <footer class="text-center text-xs text-gray-500 mt-12">
            <p><strong>データ出典:</strong></p>
            <p>区別総人口: 東京都、2024年12月1日時点</p>
            <p>区別外国人人口: 東京都、2025年1月1日時点</p>
            <p>国籍別外国人人口: 東京都総務局統計部、2024年1月1日時点</p>
            <p class="mt-4">このインフォグラフィックは教育目的で作成されたものです。</p>
        </footer>
    </main>

    <script>
        const wardData = [
            { ward: '新宿区', totalPop: 353329, foreignPop: 43897, ratio: 12.42 },
            { ward: '豊島区', totalPop: 294955, foreignPop: 31526, ratio: 10.69 },
            { ward: '荒川区', totalPop: 222343, foreignPop: 23281, ratio: 10.47 },
            { ward: '台東区', totalPop: 215956, foreignPop: 18485, ratio: 8.56 },
            { ward: '港区', totalPop: 268113, foreignPop: 21278, ratio: 7.94 },
            { ward: '北区', totalPop: 362240, foreignPop: 22543, ratio: 6.22 },
            { ward: '江東区', totalPop: 541968, foreignPop: 31698, ratio: 5.85 },
            { ward: '江戸川区', totalPop: 693921, foreignPop: 39781, ratio: 5.73 },
            { ward: '足立区', totalPop: 698180, foreignPop: 38984, ratio: 5.58 },
            { ward: '中野区', totalPop: 341500, foreignPop: 18973, ratio: 5.56 },
            { ward: '中央区', totalPop: 187297, foreignPop: 10370, ratio: 5.54 },
            { ward: '墨田区', totalPop: 287509, foreignPop: 15283, ratio: 5.31 },
            { ward: '葛飾区', totalPop: 470284, foreignPop: 24312, ratio: 5.17 },
            { ward: '板橋区', totalPop: 579001, foreignPop: 29887, ratio: 5.16 },
            { ward: '渋谷区', totalPop: 231741, foreignPop: 11598, ratio: 5.00 },
            { ward: '千代田区', totalPop: 68892, foreignPop: 3365, ratio: 4.88 },
            { ward: '品川区', totalPop: 412856, foreignPop: 16347, ratio: 3.96 },
            { ward: '文京区', totalPop: 235448, foreignPop: 9300, ratio: 3.95 },
            { ward: '目黒区', totalPop: 281536, foreignPop: 10921, ratio: 3.88 },
            { ward: '大田区', totalPop: 740254, foreignPop: 26981, ratio: 3.64 },
            { ward: '杉並区', totalPop: 577564, foreignPop: 17945, ratio: 3.11 },
            { ward: '練馬区', totalPop: 746039, foreignPop: 22810, ratio: 3.06 },
            { ward: '世田谷区', totalPop: 923411, foreignPop: 23655, ratio: 2.56 },
        ];

        const nationalityData = {
            labels: ['中国', '韓国', 'ベトナム', 'フィリピン', 'ネパール', 'その他'],
            data: [41.6, 15.0, 8.1, 5.8, 5.4, 24.1],
        };
        
        const palette = {
            deepBlue: '#004AAD',
            brightBlue: '#0079FF',
            lightBlue: '#52AFFF',
            veryLightBlue: '#B3DAFF',
            background: '#EAF6FF',
        };

        const chartColors = [palette.brightBlue, '#FFC107', '#4CAF50', '#F44336', '#9C27B0', palette.lightBlue];

        function wrapLabel(str, maxWidth) {
            if (str.length <= maxWidth) {
                return str;
            }
            const words = str.split(' ');
            const lines = [];
            let currentLine = '';
            for (const word of words) {
                if ((currentLine + word).length > maxWidth) {
                    lines.push(currentLine.trim());
                    currentLine = '';
                }
                currentLine += word + ' ';
            }
            lines.push(currentLine.trim());
            return lines;
        }

        const universalTooltipConfig = {
            plugins: {
                tooltip: {
                    callbacks: {
                        title: function(tooltipItems) {
                            const item = tooltipItems[0];
                            let label = item.chart.data.labels[item.dataIndex];
                            return Array.isArray(label) ? label.join(' ') : label;
                        }
                    },
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    titleFont: { size: 14, weight: 'bold' },
                    bodyFont: { size: 12 },
                    padding: 10,
                    cornerRadius: 4,
                    displayColors: true,
                },
                legend: {
                    labels: {
                        font: {
                            size: 12,
                            family: "'Noto Sans JP', sans-serif"
                        }
                    }
                }
            }
        };

        new Chart(document.getElementById('nationalityDonutChart').getContext('2d'), {
            type: 'doughnut',
            data: {
                labels: nationalityData.labels,
                datasets: [{
                    label: '国籍別構成比',
                    data: nationalityData.data,
                    backgroundColor: chartColors,
                    borderColor: palette.background,
                    borderWidth: 3,
                    hoverOffset: 4
                }]
            },
            options: {
                ...universalTooltipConfig,
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    ...universalTooltipConfig.plugins,
                    tooltip: {
                         ...universalTooltipConfig.plugins.tooltip,
                        callbacks: {
                            ...universalTooltipConfig.plugins.tooltip.callbacks,
                             label: function(context) {
                                let label = context.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed !== null) {
                                    label += context.parsed + '%';
                                }
                                return label;
                            }
                        }
                    }
                },
                cutout: '60%',
            }
        });

        const sortedByRatio = [...wardData].sort((a, b) => b.ratio - a.ratio);
        new Chart(document.getElementById('wardPercentageBarChart').getContext('2d'), {
            type: 'bar',
            data: {
                labels: sortedByRatio.map(d => d.ward),
                datasets: [{
                    label: '外国人比率 (%)',
                    data: sortedByRatio.map(d => d.ratio),
                    backgroundColor: palette.brightBlue,
                    borderColor: palette.deepBlue,
                    borderWidth: 1,
                    borderRadius: 4,
                }]
            },
            options: {
                ...universalTooltipConfig,
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                 scales: {
                    x: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: '外国人比率 (%)',
                            color: '#333',
                            font: { size: 14 }
                        }
                    },
                    y: {
                         ticks: {
                            font: { size: 12 }
                        }
                    }
                },
                 plugins: {
                    ...universalTooltipConfig.plugins,
                    tooltip: {
                        ...universalTooltipConfig.plugins.tooltip,
                        callbacks: {
                            ...universalTooltipConfig.plugins.tooltip.callbacks,
                            label: function(context) {
                                const index = context.dataIndex;
                                const data = sortedByRatio[index];
                                return `比率: ${data.ratio}%`;
                            },
                            afterLabel: function(context) {
                                const index = context.dataIndex;
                                const data = sortedByRatio[index];
                                return [
                                    `外国人人口: ${data.foreignPop.toLocaleString()}人`,
                                    `総人口: ${data.totalPop.toLocaleString()}人`
                                ];
                            }
                        }
                    }
                }
            }
        });

        new Chart(document.getElementById('populationBubbleChart').getContext('2d'), {
            type: 'bubble',
            data: {
                labels: wardData.map(d => d.ward),
                datasets: [{
                    label: '各区の状況',
                    data: wardData.map(d => ({
                        x: d.totalPop,
                        y: d.ratio,
                        r: Math.sqrt(d.foreignPop) / 4 
                    })),
                    backgroundColor: Chart.helpers.color(palette.brightBlue).alpha(0.6).rgbString(),
                    borderColor: palette.deepBlue,
                    borderWidth: 1,
                }]
            },
            options: {
                ...universalTooltipConfig,
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        title: { display: true, text: '総人口 (人)', color: '#333', font: { size: 14 } },
                        ticks: {
                            callback: function(value, index, values) {
                                return (value / 1000) + 'k';
                            }
                        }
                    },
                    y: {
                        title: { display: true, text: '外国人比率 (%)', color: '#333', font: { size: 14 } },
                        beginAtZero: true
                    }
                },
                plugins: {
                    ...universalTooltipConfig.plugins,
                    tooltip: {
                         ...universalTooltipConfig.plugins.tooltip,
                        callbacks: {
                            title: function(context) {
                                return context[0].chart.data.labels[context[0].dataIndex];
                            },
                            label: function(context) {
                                const index = context.dataIndex;
                                const data = wardData[index];
                                return [
                                    `総人口: ${data.totalPop.toLocaleString()}人`,
                                    `外国人比率: ${data.ratio}%`,
                                    `外国人人口: ${data.foreignPop.toLocaleString()}人`
                                ];
                            }
                        }
                    }
                }
            }
        });

    </script>
</body>
</html>
